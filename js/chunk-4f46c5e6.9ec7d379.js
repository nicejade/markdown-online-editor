(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4f46c5e6"],{"89df":function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"c",(function(){return o})),n.d(e,"b",(function(){return c}));n("28a5"),n("a481"),n("f559");"function"!==typeof String.prototype.startsWith&&(Window.String.prototype.startsWith=function(t){return this.slice(0,t.length)===t});var r=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t<10?"0".concat(t):t},a=function(){var t=new Date,e="".concat(t.getFullYear()).replace("20",""),n=r(t.getMonth()+1),a=r(t.getDate()),i=r(t.getHours()),o=r(t.getMinutes()),c=r(t.getSeconds());return"".concat(e,"-").concat(n,"-").concat(a,"-").concat(i).concat(o).concat(c)},i=function(){var t=location.pathname.split("/")[0],e=a(),n="arya-".concat(e,".").concat(t);return n},o=function(){var t=document.querySelector("html");t.style.overflow="auto",t.style.height="auto"},c=function(){var t=document.getElementById("khaleesi"),e={childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeFilter:["class","style"],attributeOldValue:!0,characterDataOldValue:!0},n=new MutationObserver((function(){var t=document.getElementsByClassName("vditor-textarea");t&&t[0]&&(t[0].style.display="none",n.disconnect())}));n.observe(t,e)}},"9dc0":function(t,e,n){"use strict";var r=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],staticClass:"preview-vditor",attrs:{"element-loading-text":"正在努力，请稍候..."}},[e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isLoading,expression:"!isLoading"}],staticClass:"vditor-preview",attrs:{id:"khaleesi"}})])},a=[],i=n("e6bc"),o=n.n(i),c=(n("ae60"),n("89df")),s={name:"PreviewVditor",data:function(){return{isLoading:!0}},props:{pdata:{type:String,required:!0,default:""}},created:function(){Object(c["c"])(),this.setDefaultText()},components:{},mounted:function(){this.initVditor(),Object(c["b"])()},methods:{initVditor:function(){var t=this,e={width:"61.8%",mode:"sv",preview:{delay:1e3,show:!0}};this.vditor=new o.a("khaleesi",e),this.$nextTick((function(){t.isLoading=!1}))},setDefaultText:function(){localStorage.setItem("vditorkhaleesi",this.pdata)}}},u=s,d=(n("af34"),n("0c7c")),l=Object(d["a"])(u,r,a,!1,null,null,null);e["a"]=l.exports},af34:function(t,e,n){"use strict";n("c370")},c370:function(t,e,n){},e103:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"export-page"},[e("div",{staticClass:"button-group"},[e("el-button",{attrs:{round:""},on:{click:t.onBackToMainPage}},[t._v("返回主页")]),e("el-button",{attrs:{round:"",type:"primary",loading:t.isExporting},on:{click:t.onExportBtnClick}},[t._v("\n      "+t._s(t.isExporting?"正在导出...":"生成导出")+"\n    ")])],1),e("PreviewVditor",{attrs:{pdata:t.pdata}})],1)},a=[],i=(n("96cf"),n("3b8d")),o=(n("a481"),n("c0e9")),c=n.n(o),s=n("0132"),u=n.n(s),d=960,l=800,h=50,g=80,p=6,v=0,f=40,m=50,w="rgba(0, 0, 0, 0.21)";function x(t,e){var n=document.createElement("canvas");n.width=d*e,n.height=l*e;var r=n.getContext("2d"),a=p*e,i=a,o=0,c=i+n.width-2*a,s=o,u=c+a,h=a,g=u,v=h+n.height-2*a,f=c,m=v+a,w=i,x=m,b=w-a,C=v,y=b,k=h;return r.beginPath(),r.moveTo(i,o),r.lineTo(c,s),r.quadraticCurveTo(u,s,u,h),r.lineTo(g,v),r.quadraticCurveTo(g,m,f,m),r.lineTo(w,x),r.quadraticCurveTo(b,x,b,C),r.lineTo(y,k),r.quadraticCurveTo(y,o,i,o),r.clip(),r.drawImage(t,0,0),n}function b(t){var e=document.createElement("canvas");e.width=t.width+h,e.height=t.height+g;var n=e.getContext("2d");return n.shadowOffsetX=v,n.shadowOffsetY=f,n.shadowBlur=m,n.shadowColor=w,n.drawImage(t,h/2,0),e}var C=function(t){for(var e=[],n=[],r=t.querySelectorAll("svg"),a=0,i=r.length;a<i;a++){var o=r[a],c=o.parentNode;try{var s=(new XMLSerializer).serializeToString(o),d=document.createElement("canvas"),l=o.getBoundingClientRect();d.width=l.width,d.height=l.height;d.getContext("2d");u()(d,s,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!1,ignoreClear:!0}),e.push({parent:c,child:o}),c.removeChild(o),n.push({parent:c,child:d}),c.appendChild(d)}catch(h){console.error("处理SVG时出错:",h)}}return{nodesToRecover:e,nodesToRemove:n}},y=function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){var n,r,a,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return C(e),n=getComputedStyle(e),d=+n.width.replace("px",""),l=+n.height.replace("px",""),r=window.devicePixelRatio,a={scale:r,allowTaint:!0,useCORS:!0,backgroundColor:"#fefefe",imageTimeout:0,logging:!1},t.next=8,c()(e,a);case 8:return i=t.sent,o=x(i,r),t.abrupt("return",b(o));case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),k=n("9dc0"),T=n("89df"),O=n("b5e2"),E=n("08fe"),S={name:"export-image",data:function(){return{isLoading:!0,isExporting:!1,pdata:Object(O["getDocContent"])(Object(O["getActiveDocId"])())||""}},created:function(){},components:{PreviewVditor:k["a"]},mounted:function(){},updated:function(){},methods:{exportAndDownloadImg:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e,n){var r,a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,y(e);case 3:r=t.sent,a="download"in document.createElement("a"),a&&(i=document.createElement("a"),i.download=n,i.href=r.toDataURL("image/png"),i.click()),t.next=13;break;case 8:t.prev=8,t.t0=t["catch"](0),console.error("导出图片失败:",t.t0),this.$message.closeAll(),this.$message.error("导出图片失败，请检查控制台获取详细错误信息");case 13:return t.prev=13,this.isLoading=!1,this.isExporting=!1,t.finish(13);case 17:case"end":return t.stop()}}),t,this,[[0,8,13,17]])})));function e(e,n){return t.apply(this,arguments)}return e}(),onBackToMainPage:function(){this.$router.push("/")},onExportBtnClick:function(){this.isLoading=!0,this.isExporting=!0;var t=document.querySelector("#khaleesi .vditor-preview"),e=Object(T["a"])();this.exportAndDownloadImg(t,e),Object(E["a"])("export_image_submit","export",e)}}},D=S,L=n("0c7c"),j=Object(L["a"])(D,r,a,!1,null,null,null);e["default"]=j.exports}}]);